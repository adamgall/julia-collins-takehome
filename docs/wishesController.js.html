<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: wishesController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: wishesController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const WishHasher = require('./WishesModel.js');
const bcrypt = require('bcrypt');
const SALT_WORK_FACTOR = 10;

db = {

  /**
   * Mongo stores wishes, input by the client, received via event emitted by smart contract and 
   * server receiving 'wish' data on listener
   * @param {string} wish -Bytes32
   */
    hashWish(wish){

    let hashedWish = '';
    bcrypt.genSalt(SALT_WORK_FACTOR, function(err, salt) {
      bcrypt.hash(wish, salt, function(err, hash) {
        if(err) {
          console.log('Error with hashing string', err)
        } else {
          console.log('Password is hashing correctly', hash);
          let newWish = new WishHasher({
            wish: hash
          });
      
          newWish.save((err, data) => {
            if(err) {
              console.log('Error saving wish to database', err)
            }
            else {
              console.log('Wish saved to be hashed')
            }
          })
        }
        });
    });
  },
  /**
   * Deletes all wishes upon request from client
   */
  deleteAllWishes(){
        WishHasher.deleteMany({}, (err, data) => {
          if(err) {
            console.log('Error deleting wishes from databse', err)
          } else {
            console.log('Wishes drained');
          }
        })
  },
  /**
   * Upon initialization of app or a rerender of the index.js page in client folder, 
   * client makes request to retrieve all wishes from db
   * @param {*} req 
   * @param {*} res 
   * @param {*} next 
   */
  getAllWishes(req, res, next) {
    WishHasher.find((err, data) => {
      if(err) {
        console.log('error', err)
      } else {
        res.locals.wishes = data;
      }
      next();
    })
  }
}

module.exports = db;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Decent Labs Technical Documentation</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Jul 28 2021 10:19:27 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
